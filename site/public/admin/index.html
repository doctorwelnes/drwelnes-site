<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Dr. Wellness Admin</title>
  </head>
  <body>
    <script>
      (function () {
        var ORIGIN = window.location.origin;
        var LOCAL_AUTH = ORIGIN + "/api/auth";

        (function () {
          try {
            var hash = window.location.hash || "";
            if (hash.indexOf("#") === 0) hash = hash.slice(1);
            if (!hash) return;

            var params = new URLSearchParams(hash);
            var token = params.get("token");
            if (!token) return;

            var provider = params.get("provider") || "github";
            var user = { token: token, provider: provider };

            try {
              localStorage.setItem("decap-cms-user", JSON.stringify(user));
            } catch (e) {}
            try {
              localStorage.setItem("netlify-cms-user", JSON.stringify(user));
            } catch (e) {}
            try {
              sessionStorage.setItem("decap-cms-user", JSON.stringify(user));
            } catch (e) {}
            try {
              sessionStorage.setItem("netlify-cms-user", JSON.stringify(user));
            } catch (e) {}

            history.replaceState(null, document.title, window.location.pathname + window.location.search);
            window.location.reload();
          } catch (e) {}
        })();

        function rewrite(url) {
          try {
            var s = String(url || "");
            if (s.indexOf("https://api.netlify.com/auth") === 0) return LOCAL_AUTH;
            if (s.indexOf("https://api.netlify.com") === 0 && s.indexOf("/auth") !== -1) return LOCAL_AUTH;
            if (s.indexOf("api.netlify.com/auth") !== -1) return LOCAL_AUTH;
            return url;
          } catch (e) {
            return url;
          }
        }

        window.addEventListener(
          "message",
          function (event) {
            try {
              if (event && event.origin && event.origin !== ORIGIN) return;
              if (event && event.data === "authorizing:github" && event.source && event.source.postMessage) {
                event.source.postMessage("authorizing:github:ack", ORIGIN);
              }
            } catch (e) {}
          },
          false
        );

        var _open = window.open;
        window.open = function (url, name, features) {
          return _open.call(window, rewrite(url), name, features);
        };

        var _assign = window.location.assign.bind(window.location);
        window.location.assign = function (url) {
          return _assign(rewrite(url));
        };

        var _replace = window.location.replace.bind(window.location);
        window.location.replace = function (url) {
          return _replace(rewrite(url));
        };

        document.addEventListener(
          "click",
          function (e) {
            var a = e.target && e.target.closest ? e.target.closest("a") : null;
            if (!a || !a.href) return;
            var newUrl = rewrite(a.href);
            if (newUrl !== a.href) {
              e.preventDefault();
              window.location.href = newUrl;
            }
          },
          true
        );
      })();
    </script>
    <script src="https://unpkg.com/decap-cms@^3.6.0/dist/decap-cms.js"></script>
  </body>
</html>
