---
import { getCollection } from "astro:content";
import Header from "../../components/Header.astro";

const items = await getCollection("exercises");
const sorted = items
  .slice()
  .sort((a, b) => {
    const ad = a.data.publishedAt ? new Date(a.data.publishedAt).getTime() : 0;
    const bd = b.data.publishedAt ? new Date(b.data.publishedAt).getTime() : 0;
    return bd - ad;
  });
---

<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700;800&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="/global.css" />
    <title>Упражнения</title>
    <style>
      .scroll-top {
        position: fixed;
        right: 16px;
        bottom: 16px;
        z-index: 50;
        display: none;
        padding: 10px 12px;
        border-radius: 12px;
        border: 1px solid rgba(17, 24, 39, 0.12);
        background: rgba(255, 255, 255, 0.92);
        backdrop-filter: blur(8px);
        box-shadow: 0 10px 30px rgba(15, 23, 42, 0.12);
        color: #111827;
        font: inherit;
        cursor: pointer;
      }

      .scroll-top.is-visible {
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }
    </style>
  </head>
  <body>
    <main style="min-height: 100vh; background: radial-gradient(1200px 600px at 20% -10%, #dbeafe 0%, rgba(219,234,254,0) 55%), radial-gradient(900px 520px at 90% 0%, #fce7f3 0%, rgba(252,231,243,0) 55%), #ffffff; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;">
      <div style="max-width: 980px; margin: 0 auto; padding: 28px 20px 36px;">
        <div id="top"></div>
        <Header />

        <section style="border: 1px solid rgba(229,231,235,.9); background: rgba(255,255,255,.8); backdrop-filter: blur(10px); border-radius: 18px; padding: 22px; box-shadow: 0 10px 30px rgba(15,23,42,.08);">
          <h1 style="margin: 0 0 10px; font-size: 28px; line-height: 1.15; letter-spacing: -0.03em;">Упражнения</h1>
          <p style="margin: 0; color: #4b5563; font-size: 16px; line-height: 1.55; max-width: 64ch;">В разработке</p>
        </section>

        <section style="margin-top: 16px; display: grid; gap: 12px;">
          {sorted.map((entry) => (
            <a
              href={`/exercises/${entry.slug}`}
              style="display: block; padding: 16px; border: 1px solid rgba(229,231,235,.9); border-radius: 16px; text-decoration: none; color: inherit; background: rgba(255,255,255,.8); box-shadow: 0 10px 30px rgba(15,23,42,.06);"
            >
              <div style="font-weight: 800; letter-spacing: -0.01em;">{entry.data.title}</div>
              {entry.data.description && (
                <div style="margin-top: 6px; color: #4b5563;">{entry.data.description}</div>
              )}
            </a>
          ))}
        </section>
      </div>

      <button id="scroll_top" type="button" class="scroll-top" aria-label="Наверх">Наверх / к списку</button>
      <script>
        (function () {
          var btn = document.getElementById('scroll_top');
          if (!btn) return;

          function toggle() {
            try {
              if (window.scrollY > 500) btn.classList.add('is-visible');
              else btn.classList.remove('is-visible');
            } catch (e) {}
          }

          try {
            window.addEventListener('scroll', toggle, { passive: true });
          } catch (e) {
            window.addEventListener('scroll', toggle);
          }
          toggle();

          btn.addEventListener('click', function () {
            try {
              var top = document.getElementById('top');
              if (top && top.scrollIntoView) {
                top.scrollIntoView({ behavior: 'smooth', block: 'start' });
                return;
              }
            } catch (e) {}

            try {
              window.scrollTo({ top: 0, behavior: 'smooth' });
            } catch (e) {
              window.scrollTo(0, 0);
            }
          });
        })();
      </script>
    </main>
  </body>
</html>
