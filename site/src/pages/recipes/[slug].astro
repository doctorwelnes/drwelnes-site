---
import { getCollection } from "astro:content";
import { toEmbedUrl } from "../../lib/video";

export async function getStaticPaths() {
  const items = await getCollection("recipes");
  return items.map((entry) => ({ params: { slug: entry.slug }, props: { entry } }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();
---

<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>{entry.data.title}</title>
  </head>
  <body>
    <main style="min-height: 100vh; background: radial-gradient(1200px 600px at 20% -10%, #dbeafe 0%, rgba(219,234,254,0) 55%), radial-gradient(900px 520px at 90% 0%, #fce7f3 0%, rgba(252,231,243,0) 55%), #ffffff; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;">
      <div style="max-width: 980px; margin: 0 auto; padding: 28px 20px 36px;">
        <header style="display: flex; align-items: center; justify-content: space-between; gap: 12px; margin-bottom: 18px;">
          <div style="display: flex; align-items: center; gap: 10px;">
            <img src="/logo.png" alt="Dr.Welnes" width="34" height="34" style="display:block; width:34px; height:34px; border-radius: 10px; object-fit: cover;" />
            <div style="font-weight: 700; letter-spacing: -0.01em;">Dr.Welnes</div>
          </div>
          <nav style="display: flex; flex-wrap: wrap; gap: 10px;">
            <a href="/recipes" style="text-decoration: none; color: #111827; padding: 8px 10px; border-radius: 10px;">Рецепты</a>
            <a href="/exercises" style="text-decoration: none; color: #111827; padding: 8px 10px; border-radius: 10px;">Упражнения</a>
            <a href="/theory" style="text-decoration: none; color: #111827; padding: 8px 10px; border-radius: 10px;">Теория</a>
            <a href="/calculators" style="text-decoration: none; color: #111827; padding: 8px 10px; border-radius: 10px;">Калькуляторы</a>
          </nav>
        </header>

        <section style="border: 1px solid rgba(229,231,235,.9); background: rgba(255,255,255,.8); backdrop-filter: blur(10px); border-radius: 18px; padding: 22px; box-shadow: 0 10px 30px rgba(15,23,42,.08);">
          <h1 style="margin: 0 0 8px; font-size: 28px; line-height: 1.15; letter-spacing: -0.03em;">{entry.data.title}</h1>
          {entry.data.description && (
            <p style="margin: 0; color: #4b5563;">{entry.data.description}</p>
          )}
        </section>

      {entry.data.videoFile ? (
        <div style="margin: 16px 0;">
          <video
            controls
            playsinline
            preload="metadata"
            style="width: 100%; max-height: 520px; border-radius: 12px; background: #000;"
            src={entry.data.videoFile}
          />
        </div>
      ) : (
        entry.data.videoUrl && (
          <div style="margin: 16px 0;">
            <iframe
              width="100%"
              height="420"
              src={toEmbedUrl(entry.data.videoUrl)}
              title={entry.data.title}
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen
              style="border: 0; border-radius: 12px;"
            />
          </div>
        )
      )}

        {(entry.data.kbru || (entry.data.ingredients && entry.data.ingredients.length) || (entry.data.steps && entry.data.steps.length)) && (
          <section style="margin: 16px 0; display: grid; gap: 12px;">
            {entry.data.kbru && (
              <div style="background: rgba(255,255,255,.85); border: 1px solid rgba(229,231,235,.9); border-radius: 18px; padding: 18px; box-shadow: 0 10px 30px rgba(15,23,42,.06);">
                <h2 style="margin: 0 0 10px; font-size: 18px; letter-spacing: -0.01em;">КБЖУ (на 100 г)</h2>
                <div style="display: grid; grid-template-columns: repeat(4, minmax(0, 1fr)); gap: 10px;">
                  <div style="padding: 10px 12px; border-radius: 14px; background: rgba(249,250,251,.85); border: 1px solid rgba(229,231,235,.9);">
                    <div style="font-size: 12px; color: #6b7280;">Ккал</div>
                    <div style="font-weight: 700;">{entry.data.kbru.calories ?? "—"}</div>
                  </div>
                  <div style="padding: 10px 12px; border-radius: 14px; background: rgba(249,250,251,.85); border: 1px solid rgba(229,231,235,.9);">
                    <div style="font-size: 12px; color: #6b7280;">Белки</div>
                    <div style="font-weight: 700;">{entry.data.kbru.protein ?? "—"}</div>
                  </div>
                  <div style="padding: 10px 12px; border-radius: 14px; background: rgba(249,250,251,.85); border: 1px solid rgba(229,231,235,.9);">
                    <div style="font-size: 12px; color: #6b7280;">Жиры</div>
                    <div style="font-weight: 700;">{entry.data.kbru.fat ?? "—"}</div>
                  </div>
                  <div style="padding: 10px 12px; border-radius: 14px; background: rgba(249,250,251,.85); border: 1px solid rgba(229,231,235,.9);">
                    <div style="font-size: 12px; color: #6b7280;">Углеводы</div>
                    <div style="font-weight: 700;">{entry.data.kbru.carbs ?? "—"}</div>
                  </div>
                </div>
              </div>
            )}

            {entry.data.ingredients && entry.data.ingredients.length > 0 && (
              <div style="background: rgba(255,255,255,.85); border: 1px solid rgba(229,231,235,.9); border-radius: 18px; padding: 18px; box-shadow: 0 10px 30px rgba(15,23,42,.06);">
                <h2 style="margin: 0 0 10px; font-size: 18px; letter-spacing: -0.01em;">Ингредиенты</h2>
                <ul style="margin: 0; padding-left: 18px;">
                  {entry.data.ingredients.map((it) => (
                    <li>
                      <span style="font-weight: 600;">{it.name}</span>
                      {it.amount ? <span style="color:#6b7280;"> — {it.amount}</span> : null}
                    </li>
                  ))}
                </ul>
              </div>
            )}

            {entry.data.steps && entry.data.steps.length > 0 && (
              <div style="background: rgba(255,255,255,.85); border: 1px solid rgba(229,231,235,.9); border-radius: 18px; padding: 18px; box-shadow: 0 10px 30px rgba(15,23,42,.06);">
                <h2 style="margin: 0 0 10px; font-size: 18px; letter-spacing: -0.01em;">Шаги</h2>
                <ol style="margin: 0; padding-left: 18px;">
                  {entry.data.steps.map((t) => (
                    <li>{t}</li>
                  ))}
                </ol>
              </div>
            )}
          </section>
        )}

        <article style="line-height: 1.6; background: rgba(255,255,255,.85); border: 1px solid rgba(229,231,235,.9); border-radius: 18px; padding: 18px; box-shadow: 0 10px 30px rgba(15,23,42,.06);">
          <Content />
        </article>
      </div>
    </main>
  </body>
</html>
