---
import SiteLayout from "../layouts/SiteLayout.astro";
---

<SiteLayout title="Калькуляторы" active="calculators">
  <section class="card card--hero" data-animate style="--delay: 0.05s;">
    <h1 class="hero-title">Калькуляторы</h1>
    <p class="hero-subtitle">ИМТ, TDEE и оценка 1RM — быстро и без регистрации.</p>
    <div class="chip-row" style="margin-top: 12px;">
      <span class="chip">Быстрые расчёты</span>
      <span class="chip">Без регистрации</span>
      <span class="chip">Результат сразу</span>
    </div>
  </section>

  <div class="calc-tabs" data-animate style="--delay: 0.1s;">
    <a href="#bmi" data-calc="bmi" class="calc-tab is-active">ИМТ</a>
    <a href="#tdee" data-calc="tdee" class="calc-tab">TDEE</a>
    <a href="#1rm" data-calc="1rm" class="calc-tab">1RM</a>
  </div>

  <section id="bmi" data-calc-panel class="card card--soft calc-panel" data-animate style="--delay: 0.15s;">
    <h2 class="section-title">ИМТ (BMI)</h2>
    <div class="form-grid form-grid--narrow">
      <label class="field">
        <span class="field-label">Рост (см)</span>
        <input id="bmi_h" type="number" inputmode="decimal" class="input" />
      </label>
      <label class="field">
        <span class="field-label">Вес (кг)</span>
        <input id="bmi_w" type="number" inputmode="decimal" class="input" />
      </label>
      <button id="bmi_btn" type="button" class="btn btn--primary">Посчитать</button>
      <div id="bmi_out" class="calc-output"></div>
    </div>
  </section>

  <section id="tdee" data-calc-panel class="card card--soft calc-panel" hidden data-animate style="--delay: 0.2s;">
    <h2 class="section-title">TDEE (поддержание калорий)</h2>
    <div class="form-grid">
      <label class="field">
        <span class="field-label">Пол</span>
        <select id="tdee_sex" class="input">
          <option value="male">Муж</option>
          <option value="female">Жен</option>
        </select>
      </label>
      <label class="field">
        <span class="field-label">Возраст (лет)</span>
        <input id="tdee_age" type="number" class="input" />
      </label>
      <label class="field">
        <span class="field-label">Рост (см)</span>
        <input id="tdee_h" type="number" class="input" />
      </label>
      <label class="field">
        <span class="field-label">Вес (кг)</span>
        <input id="tdee_w" type="number" class="input" />
      </label>
      <label class="field">
        <span class="field-label">Активность</span>
        <select id="tdee_act" class="input">
          <option value="1.2">Минимальная (сидячий)</option>
          <option value="1.375">Лёгкая (1-3 трен/нед)</option>
          <option value="1.55">Средняя (3-5 трен/нед)</option>
          <option value="1.725">Высокая (6-7 трен/нед)</option>
          <option value="1.9">Очень высокая (физ. работа)</option>
        </select>
      </label>
      <button id="tdee_btn" type="button" class="btn btn--primary">Посчитать</button>
      <div id="tdee_out" class="calc-output"></div>
    </div>
  </section>

  <section id="1rm" data-calc-panel class="card card--soft calc-panel" hidden data-animate style="--delay: 0.25s;">
    <h2 class="section-title">1RM (оценка максимума на 1 повтор)</h2>
    <div class="form-grid form-grid--narrow">
      <label class="field">
        <span class="field-label">Вес (кг)</span>
        <input id="rm_w" type="number" inputmode="decimal" class="input" />
      </label>
      <label class="field">
        <span class="field-label">Повторы (1-12)</span>
        <input id="rm_r" type="number" class="input" />
      </label>
      <button id="rm_btn" type="button" class="btn btn--primary">Посчитать</button>
      <div id="rm_out" class="calc-output"></div>
    </div>
  </section>

  <script slot="scripts">
    (function () {
      function setActive(id) {
        try {
          var panels = document.querySelectorAll('[data-calc-panel]');
          for (var i = 0; i < panels.length; i++) {
            var p = panels[i];
            p.hidden = p.id !== id;
          }

          var links = document.querySelectorAll('a[data-calc]');
          for (var j = 0; j < links.length; j++) {
            var a = links[j];
            var isActive = a.getAttribute('data-calc') === id;
            if (isActive) {
              a.classList.add('is-active');
            } else {
              a.classList.remove('is-active');
            }
          }
        } catch (e) {}
      }

      function readHash() {
        var h = (window.location.hash || '').replace('#', '').trim();
        if (h === 'bmi' || h === 'tdee' || h === '1rm') return h;
        return 'bmi';
      }

      function n(v) {
        var x = Number(v);
        return Number.isFinite(x) ? x : NaN;
      }

      try {
        setActive(readHash());
        window.addEventListener('hashchange', function () {
          setActive(readHash());
        });
      } catch (e) {}

      var bmiBtn = document.getElementById('bmi_btn');
      bmiBtn && bmiBtn.addEventListener('click', function () {
        var h = n(document.getElementById('bmi_h').value) / 100;
        var w = n(document.getElementById('bmi_w').value);
        var out = document.getElementById('bmi_out');
        if (!out) return;
        if (!h || !w) { out.textContent = 'Заполни рост и вес.'; return; }
        var bmi = w / (h * h);
        out.textContent = 'ИМТ: ' + bmi.toFixed(1);
      });

      var tdeeBtn = document.getElementById('tdee_btn');
      tdeeBtn && tdeeBtn.addEventListener('click', function () {
        var sex = document.getElementById('tdee_sex').value;
        var age = n(document.getElementById('tdee_age').value);
        var h = n(document.getElementById('tdee_h').value);
        var w = n(document.getElementById('tdee_w').value);
        var act = n(document.getElementById('tdee_act').value);
        var out = document.getElementById('tdee_out');
        if (!out) return;
        if (!age || !h || !w || !act) { out.textContent = 'Заполни все поля.'; return; }
        // Mifflin-St Jeor
        var bmr = (sex === 'male')
          ? (10 * w + 6.25 * h - 5 * age + 5)
          : (10 * w + 6.25 * h - 5 * age - 161);
        var tdee = bmr * act;
        out.textContent = 'Поддержание: ' + Math.round(tdee) + ' ккал/день';
      });

      var rmBtn = document.getElementById('rm_btn');
      rmBtn && rmBtn.addEventListener('click', function () {
        var w = n(document.getElementById('rm_w').value);
        var r = n(document.getElementById('rm_r').value);
        var out = document.getElementById('rm_out');
        if (!out) return;
        if (!w || !r) { out.textContent = 'Заполни вес и повторы.'; return; }
        if (r < 1 || r > 12) { out.textContent = 'Повторы должны быть 1-12.'; return; }
        // Epley
        var oneRm = w * (1 + r / 30);
        out.textContent = '1RM (оценка): ' + oneRm.toFixed(1) + ' кг';
      });
    })();
  </script>
</SiteLayout>
